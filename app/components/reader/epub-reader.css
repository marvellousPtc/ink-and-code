/* ============================================
   Beautiful EPUB Book Reader — Book Frame Styles
   ============================================ */

/* 书本外层容器：居中 + 阴影 */
.book-container {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 100%;
  height: 100%;
  position: relative;
  overflow: hidden;
}

/* 书本外框：包含翻页区和装饰 */
.book-frame {
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
}

/* 书本主体阴影 */
.book-shadow {
  position: absolute;
  inset: -8px;
  border-radius: 6px;
  pointer-events: none;
  box-shadow:
    0 2px 8px rgba(0, 0, 0, 0.08),
    0 8px 24px rgba(0, 0, 0, 0.12),
    0 16px 48px rgba(0, 0, 0, 0.08),
    0 0 0 1px rgba(0, 0, 0, 0.04);
  z-index: 0;
}

/* 左侧页边堆叠效果 */
.page-stack-left {
  position: absolute;
  left: -3px;
  top: 4px;
  bottom: 4px;
  width: 6px;
  pointer-events: none;
  z-index: 1;
  background: linear-gradient(
    to right,
    rgba(0, 0, 0, 0.06),
    rgba(0, 0, 0, 0.03) 30%,
    rgba(0, 0, 0, 0.01) 60%,
    transparent
  );
  border-radius: 2px 0 0 2px;
}

/* 右侧页边堆叠效果 */
.page-stack-right {
  position: absolute;
  right: -3px;
  top: 4px;
  bottom: 4px;
  width: 6px;
  pointer-events: none;
  z-index: 1;
  background: linear-gradient(
    to left,
    rgba(0, 0, 0, 0.06),
    rgba(0, 0, 0, 0.03) 30%,
    rgba(0, 0, 0, 0.01) 60%,
    transparent
  );
  border-radius: 0 2px 2px 0;
}

/* 书脊阴影（两页中间的分界线） */
.book-spine {
  position: absolute;
  top: 0;
  bottom: 0;
  left: 50%;
  width: 30px;
  transform: translateX(-50%);
  pointer-events: none;
  z-index: 10;
  background: linear-gradient(
    to right,
    transparent 0%,
    rgba(0, 0, 0, 0.03) 20%,
    rgba(0, 0, 0, 0.08) 45%,
    rgba(0, 0, 0, 0.12) 50%,
    rgba(0, 0, 0, 0.08) 55%,
    rgba(0, 0, 0, 0.03) 80%,
    transparent 100%
  );
}

/* 书脊高光（微妙的光泽效果） */
.book-spine::after {
  content: '';
  position: absolute;
  top: 0;
  bottom: 0;
  left: 50%;
  width: 1px;
  background: rgba(255, 255, 255, 0.08);
}

/* ---- react-pageflip 容器样式覆盖 ---- */

/* 确保翻页组件圆角 */
.book-flipbook {
  border-radius: 3px;
  overflow: visible;
}

/* 页面本身
 *
 * 关键：这些样式必须通过 CSS class 设置，而不是 inline style。
 * 原因：page-flip 库在翻页动画中会用 style.cssText = "..." 完全替换
 * 页面元素的 inline style，导致 backgroundColor、overflow 等丢失。
 * CSS class 的属性不会被 style.cssText 覆盖（只要 inline 中没设同名属性）。
 */
.book-page {
  /* 纸张背景色 — 不能用 inline style，否则翻页时丢失导致透明 */
  background-color: #f8f5f0;
  color: #333;
  overflow: hidden;
  box-sizing: border-box;

  /* 性能优化：告诉浏览器每页内容独立，不影响其他元素布局 */
  contain: layout style paint;

  /* GPU 合成层：翻页动画的 transform 由 GPU 处理，不触发主线程重绘 */
  will-change: transform;
  -webkit-backface-visibility: hidden;
  backface-visibility: hidden;

  /* 纸张纹理 */
  background-image:
    linear-gradient(
      135deg,
      rgba(0, 0, 0, 0.008) 0%,
      rgba(0, 0, 0, 0.003) 50%,
      rgba(0, 0, 0, 0.005) 100%
    );
}

/* 内容层提升为独立合成层，避免翻页时重绘文字内容 */
.epub-page-content {
  transform: translateZ(0);
}

/* 深色主题页面 */
.book-theme-dark .book-page {
  background-color: #2a2520;
  color: #c8c0b8;
}

/* 羊皮纸主题页面 */
.book-theme-sepia .book-page {
  background-color: #f4ecd8;
  color: #5b4636;
}

/* ---- 主题变体 ---- */

/* 深色主题 */
.book-theme-dark .book-shadow {
  box-shadow:
    0 2px 8px rgba(0, 0, 0, 0.3),
    0 8px 24px rgba(0, 0, 0, 0.4),
    0 16px 48px rgba(0, 0, 0, 0.3),
    0 0 0 1px rgba(255, 255, 255, 0.05);
}

.book-theme-dark .book-spine {
  background: linear-gradient(
    to right,
    transparent 0%,
    rgba(0, 0, 0, 0.06) 20%,
    rgba(0, 0, 0, 0.18) 45%,
    rgba(0, 0, 0, 0.25) 50%,
    rgba(0, 0, 0, 0.18) 55%,
    rgba(0, 0, 0, 0.06) 80%,
    transparent 100%
  );
}

.book-theme-dark .page-stack-left,
.book-theme-dark .page-stack-right {
  background: linear-gradient(
    to right,
    rgba(0, 0, 0, 0.15),
    rgba(0, 0, 0, 0.05) 60%,
    transparent
  );
}

.book-theme-dark .page-stack-right {
  background: linear-gradient(
    to left,
    rgba(0, 0, 0, 0.15),
    rgba(0, 0, 0, 0.05) 60%,
    transparent
  );
}

/* 羊皮纸主题 */
.book-theme-sepia .book-shadow {
  box-shadow:
    0 2px 8px rgba(90, 70, 50, 0.1),
    0 8px 24px rgba(90, 70, 50, 0.15),
    0 16px 48px rgba(90, 70, 50, 0.1),
    0 0 0 1px rgba(90, 70, 50, 0.08);
}

.book-theme-sepia .book-spine {
  background: linear-gradient(
    to right,
    transparent 0%,
    rgba(90, 70, 50, 0.04) 20%,
    rgba(90, 70, 50, 0.1) 45%,
    rgba(90, 70, 50, 0.14) 50%,
    rgba(90, 70, 50, 0.1) 55%,
    rgba(90, 70, 50, 0.04) 80%,
    transparent 100%
  );
}

/* ---- 加载状态 ---- */
.book-loading {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 16px;
  width: 100%;
  height: 100%;
}

.book-loading-spinner {
  width: 32px;
  height: 32px;
  border: 2px solid currentColor;
  border-top-color: transparent;
  border-radius: 50%;
  opacity: 0.4;
  animation: spin 0.8s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* ---- 移动端单页模式：全屏翻页 ---- */
@media (max-width: 767px) {
  .book-container {
    padding: 0;
    align-items: stretch;
    justify-content: stretch;
    /* 消除移动端 300ms 触摸延迟，让翻页手势立即响应 */
    touch-action: manipulation;
  }

  .book-frame {
    width: 100%;
    height: 100%;
    justify-content: center;
    align-items: stretch;
  }

  /* 移动端翻页容器全屏 */
  .book-flipbook {
    border-radius: 0;
    width: 100% !important;
    height: 100% !important;
  }

  /* 移动端页面去掉纸张纹理，全屏铺满 */
  .book-page {
    background-image: none;
    border-radius: 0;
  }
}

.book-spine-hidden {
  display: none;
}

/* ---- 翻页时的附加视觉效果 ---- */

/* react-pageflip 翻页优化 — 不要覆盖库自身的 transform/backface 管理 */
.stf__wrapper {
  --shadow-color: rgba(0, 0, 0, 0.15);
}
